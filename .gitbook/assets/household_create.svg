<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2225px" preserveAspectRatio="none" style="width:2179px;height:2225px;background:#FFFFFF;" version="1.1" viewBox="0 0 2179 2225" width="2179px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1822.9063" style="stroke:#696969;stroke-width:1.0;" width="10" x="750.5" y="98.4297"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1028.5" y="910.4844"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1028.5" y="1210.5469"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1253.5" y="568.1563"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1253.5" y="668.5547"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="1253.5" y="785.0859"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="1253.5" y="1862.2031"/><rect fill="#FFFFFF" height="93.832" style="stroke:#696969;stroke-width:1.0;" width="10" x="1342.5" y="246.5273"/><rect fill="#FFFFFF" height="93.832" style="stroke:#696969;stroke-width:1.0;" width="10" x="1342.5" y="979.3164"/><rect fill="#FFFFFF" height="93.832" style="stroke:#696969;stroke-width:1.0;" width="10" x="1342.5" y="1501.4414"/><rect fill="#FFFFFF" height="303.9297" style="stroke:#696969;stroke-width:1.0;" width="10" x="1342.5" y="1833.0703"/><rect fill="#FFFFFF" height="147.3984" style="stroke:#696969;stroke-width:1.0;" width="10" x="1538.5" y="1974.6016"/><rect fill="#FFFFFF" height="59.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1674.5" y="2003.7344"/><rect fill="#FFFFFF" height="89.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1796.5" y="310.3594"/><rect fill="#FFFFFF" height="89.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1796.5" y="1043.1484"/><rect fill="#FFFFFF" height="89.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1796.5" y="1565.2734"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="1913" y="2032.8672"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2057.5" y="369.4922"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="2057.5" y="726.8203"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2057.5" y="1102.2813"/><rect fill="#FFFFFF" height="869.1875" style="stroke:#696969;stroke-width:1.0;" width="10" x="2057.5" y="1268.8125"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2062.5" y="1624.4063"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2062.5" y="2092"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="2131.5" y="1432.6094"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="2131.5" y="1732.6719"/><rect fill="none" height="294.0625" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1981.5" x="138" y="155.5625"/><rect fill="none" height="135.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="802.5" x="1307" y="272.0938"/><rect fill="none" height="352.4609" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1959.5" x="150" y="505.7578"/><rect fill="none" height="110.5313" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1157" x="160" y="529.8906"/><rect fill="none" height="310.1953" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1925.5" x="194" y="872.2188"/><rect fill="none" height="135.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="802.5" x="1307" y="1004.8828"/><rect fill="none" height="96.5313" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2100.5" x="9" y="1283.8125"/><rect fill="none" height="310.1953" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1994.5" x="179" y="1394.3438"/><rect fill="none" height="135.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="802.5" x="1307" y="1527.0078"/><rect fill="none" height="193.6641" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="802.5" x="1307" y="1936.3359"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="446" x2="446" y1="67.2969" y2="2147"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="755.5" x2="755.5" y1="67.2969" y2="2147"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1033" x2="1033" y1="67.2969" y2="2147"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1258" x2="1258" y1="67.2969" y2="2147"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1347" x2="1347" y1="67.2969" y2="2147"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1543" x2="1543" y1="67.2969" y2="2147"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1679" x2="1679" y1="67.2969" y2="2147"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1801" x2="1801" y1="67.2969" y2="2147"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1918" x2="1918" y1="67.2969" y2="2147"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2062.5" x2="2062.5" y1="67.2969" y2="2147"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2136.5" x2="2136.5" y1="67.2969" y2="2147"/><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="57" x="418" y="36"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="425" y="55.9951">Client</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="57" x="418" y="2146"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="425" y="2165.9951">Client</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="148" x="681.5" y="36"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="688.5" y="55.9951">HouseholdRegistry</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="148" x="681.5" y="2146"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="688.5" y="2165.9951">HouseholdRegistry</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="141" x="963" y="36"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="970" y="55.9951">IndividualRegistry</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="141" x="963" y="2146"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="970" y="2165.9951">IndividualRegistry</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="97" x="1210" y="36"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="1217" y="55.9951">RedisCache</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="97" x="1210" y="2146"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="1217" y="2165.9951">RedisCache</text><path d="M1322,41 L1373,41 C1378,41 1378,54.1484 1378,54.1484 C1378,54.1484 1378,67.2969 1373,67.2969 L1322,67.2969 C1317,67.2969 1317,54.1484 1317,54.1484 C1317,54.1484 1317,41 1322,41 " fill="#FF6347" style="stroke:#454645;stroke-width:1.5;"/><path d="M1373,41 C1368,41 1368,54.1484 1368,54.1484 C1368,67.2969 1373,67.2969 1373,67.2969 " fill="none" style="stroke:#454645;stroke-width:1.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="1322" y="58.9951">Kafka</text><path d="M1322,2146 L1373,2146 C1378,2146 1378,2159.1484 1378,2159.1484 C1378,2159.1484 1378,2172.2969 1373,2172.2969 L1322,2172.2969 C1317,2172.2969 1317,2159.1484 1317,2159.1484 C1317,2159.1484 1317,2146 1322,2146 " fill="#FF6347" style="stroke:#454645;stroke-width:1.5;"/><path d="M1373,2146 C1368,2146 1368,2159.1484 1368,2159.1484 C1368,2172.2969 1373,2172.2969 1373,2172.2969 " fill="none" style="stroke:#454645;stroke-width:1.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="1322" y="2163.9951">Kafka</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="131" x="1478" y="36"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="1485" y="55.9951">PersisterService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="131" x="1478" y="2146"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="1485" y="2165.9951">PersisterService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="121" x="1619" y="36"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="1626" y="55.9951">IndexerService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="121" x="1619" y="2146"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="1626" y="2165.9951">IndexerService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="103" x="1750" y="36"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1757" y="55.9951">ErrorService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="103" x="1750" y="2146"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1757" y="2165.9951">ErrorService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="110" x="1863" y="36"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="1870" y="55.9951">ElasticSearch</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="110" x="1863" y="2146"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="1870" y="2165.9951">ElasticSearch</text><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="2025.5" y="63.9951">Database</text><path d="M2044.5,15 C2044.5,5 2062.5,5 2062.5,5 C2062.5,5 2080.5,5 2080.5,15 L2080.5,41 C2080.5,51 2062.5,51 2062.5,51 C2062.5,51 2044.5,51 2044.5,41 L2044.5,15 " fill="#00FFFF" style="stroke:#454645;stroke-width:1.5;"/><path d="M2044.5,15 C2044.5,25 2062.5,25 2062.5,25 C2062.5,25 2080.5,25 2080.5,15 " fill="none" style="stroke:#454645;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="2025.5" y="2158.9951">Database</text><path d="M2044.5,2172.2969 C2044.5,2162.2969 2062.5,2162.2969 2062.5,2162.2969 C2062.5,2162.2969 2080.5,2162.2969 2080.5,2172.2969 L2080.5,2198.2969 C2080.5,2208.2969 2062.5,2208.2969 2062.5,2208.2969 C2062.5,2208.2969 2044.5,2208.2969 2044.5,2198.2969 L2044.5,2172.2969 " fill="#00FFFF" style="stroke:#454645;stroke-width:1.5;"/><path d="M2044.5,2172.2969 C2044.5,2182.2969 2062.5,2182.2969 2062.5,2182.2969 C2062.5,2182.2969 2080.5,2182.2969 2080.5,2172.2969 " fill="none" style="stroke:#454645;stroke-width:1.5;"/><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="54" x="2109.5" y="36"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="2116.5" y="55.9951">idgen</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="54" x="2109.5" y="2146"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="2116.5" y="2165.9951">idgen</text><rect fill="#FFFFFF" height="1822.9063" style="stroke:#696969;stroke-width:1.0;" width="10" x="750.5" y="98.4297"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1028.5" y="910.4844"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1028.5" y="1210.5469"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1253.5" y="568.1563"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1253.5" y="668.5547"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="1253.5" y="785.0859"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="1253.5" y="1862.2031"/><rect fill="#FFFFFF" height="93.832" style="stroke:#696969;stroke-width:1.0;" width="10" x="1342.5" y="246.5273"/><rect fill="#FFFFFF" height="93.832" style="stroke:#696969;stroke-width:1.0;" width="10" x="1342.5" y="979.3164"/><rect fill="#FFFFFF" height="93.832" style="stroke:#696969;stroke-width:1.0;" width="10" x="1342.5" y="1501.4414"/><rect fill="#FFFFFF" height="303.9297" style="stroke:#696969;stroke-width:1.0;" width="10" x="1342.5" y="1833.0703"/><rect fill="#FFFFFF" height="147.3984" style="stroke:#696969;stroke-width:1.0;" width="10" x="1538.5" y="1974.6016"/><rect fill="#FFFFFF" height="59.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1674.5" y="2003.7344"/><rect fill="#FFFFFF" height="89.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1796.5" y="310.3594"/><rect fill="#FFFFFF" height="89.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1796.5" y="1043.1484"/><rect fill="#FFFFFF" height="89.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1796.5" y="1565.2734"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="1913" y="2032.8672"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2057.5" y="369.4922"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="2057.5" y="726.8203"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2057.5" y="1102.2813"/><rect fill="#FFFFFF" height="869.1875" style="stroke:#696969;stroke-width:1.0;" width="10" x="2057.5" y="1268.8125"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2062.5" y="1624.4063"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2062.5" y="2092"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="2131.5" y="1432.6094"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="2131.5" y="1732.6719"/><polygon fill="#454645" points="738.5,94.4297,748.5,98.4297,738.5,102.4297,742.5,98.4297" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="446.5" x2="744.5" y1="98.4297" y2="98.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="453.5" y="93.3638">/household/v1/_create</text><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="802.5" y1="127.5625" y2="127.5625"/><line style="stroke:#454645;stroke-width:1.0;" x1="802.5" x2="802.5" y1="127.5625" y2="140.5625"/><line style="stroke:#454645;stroke-width:1.0;" x1="761.5" x2="802.5" y1="140.5625" y2="140.5625"/><polygon fill="#454645" points="771.5,136.5625,761.5,140.5625,771.5,144.5625,767.5,140.5625" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="767.5" y="122.4966">Validate request body</text><path d="M141.5,155.5625 L204,155.5625 L204,162.6953 L194,172.6953 L138,172.6953 L138,159.0625 A3.5,3.5 0 0 1 141.5,155.5625 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="294.0625" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1981.5" x="138" y="155.5625"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="153" y="168.6294">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="167" x="219" y="167.7729">[request validation fails]</text><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="802.5" y1="193.8281" y2="193.8281"/><line style="stroke:#454645;stroke-width:1.0;" x1="802.5" x2="802.5" y1="193.8281" y2="206.8281"/><line style="stroke:#454645;stroke-width:1.0;" x1="761.5" x2="802.5" y1="206.8281" y2="206.8281"/><polygon fill="#454645" points="771.5,202.8281,761.5,206.8281,771.5,210.8281,767.5,206.8281" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="767.5" y="188.7622">Request validation failed</text><polygon fill="#454645" points="1330.5,242.5273,1340.5,246.5273,1330.5,250.5273,1334.5,246.5273" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="1336.5" y1="246.5273" y2="246.5273"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="767.5" y="241.4614">Household Data /error_topic</text><path d="M410,223.3281 L410,256.3281 A3.5,3.5 0 0 0 413.5,259.8281 L741.5,259.8281 A3.5,3.5 0 0 0 745,256.3281 L745,229.8281 L735,219.8281 L413.5,219.8281 A3.5,3.5 0 0 0 410,223.3281 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M735,219.8281 L735,228.0781 A1.75,1.75 0 0 0 736.75,229.8281 L745,229.8281 L735,219.8281 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310" x="416" y="236.895">This will be marked as unrecoverable right away</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="416" y="252.0278">and require manual intervention</text><path d="M1310.5,272.0938 L1394,272.0938 L1394,279.2266 L1384,289.2266 L1307,289.2266 L1307,275.5938 A3.5,3.5 0 0 1 1310.5,272.0938 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="135.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="802.5" x="1307" y="272.0938"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1322" y="285.1606">async</text><polygon fill="#454645" points="1363.5,306.3594,1353.5,310.3594,1363.5,314.3594,1359.5,310.3594" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1357.5" x2="1795.5" y1="310.3594" y2="310.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="1369.5" y="305.2935">Consume Household Data</text><polygon fill="#454645" points="2045.5,365.4922,2055.5,369.4922,2045.5,373.4922,2049.5,369.4922" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1806.5" x2="2051.5" y1="369.4922" y2="369.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1813.5" y="364.4263">Persist Household Data /error_table</text><polygon fill="#454645" points="457.5,434.625,447.5,438.625,457.5,442.625,453.5,438.625" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="451.5" x2="749.5" y1="438.625" y2="438.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="463.5" y="433.5591">HttpStatus: 400 with appropriate error code</text><path d="M148,422.9922 L148,440.9922 A3.5,3.5 0 0 0 151.5,444.4922 L437.5,444.4922 A3.5,3.5 0 0 0 441,440.9922 L441,429.4922 L431,419.4922 L151.5,419.4922 A3.5,3.5 0 0 0 148,422.9922 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M431,419.4922 L431,427.7422 A1.75,1.75 0 0 0 432.75,429.4922 L441,429.4922 L431,419.4922 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="154" y="436.5591">Error Code: REQUEST_VALIDATION_FAILED</text><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="802.5" y1="477.7578" y2="477.7578"/><line style="stroke:#454645;stroke-width:1.0;" x1="802.5" x2="802.5" y1="477.7578" y2="490.7578"/><line style="stroke:#454645;stroke-width:1.0;" x1="761.5" x2="802.5" y1="490.7578" y2="490.7578"/><polygon fill="#454645" points="771.5,486.7578,761.5,490.7578,771.5,494.7578,767.5,490.7578" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="767.5" y="472.6919">Request validation successful</text><path d="M153.5,505.7578 L216,505.7578 L216,512.8906 L206,522.8906 L150,522.8906 L150,509.2578 A3.5,3.5 0 0 1 153.5,505.7578 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="352.4609" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1959.5" x="150" y="505.7578"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="165" y="518.8247">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="151" x="231" y="517.9683">[record already exists]</text><path d="M163.5,529.8906 L226,529.8906 L226,537.0234 L216,547.0234 L160,547.0234 L160,533.3906 A3.5,3.5 0 0 1 163.5,529.8906 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="110.5313" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1157" x="160" y="529.8906"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="175" y="542.9575">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="156" x="241" y="542.1011">[record found in cache]</text><polygon fill="#454645" points="1241.5,564.1563,1251.5,568.1563,1241.5,572.1563,1245.5,568.1563" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="1247.5" y1="568.1563" y2="568.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="767.5" y="563.0903">Check using clientReferenceId / serverGeneratedId</text><polygon fill="#454645" points="771.5,593.2891,761.5,597.2891,771.5,601.2891,767.5,597.2891" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="765.5" x2="1257.5" y1="597.2891" y2="597.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="777.5" y="592.2231">1 row</text><polygon fill="#454645" points="457.5,625.4219,447.5,629.4219,457.5,633.4219,453.5,629.4219" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="451.5" x2="749.5" y1="629.4219" y2="629.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="463.5" y="624.356">HttpStatus: 400 with appropriate error code</text><path d="M170,613.7891 L170,631.7891 A3.5,3.5 0 0 0 173.5,635.2891 L437.5,635.2891 A3.5,3.5 0 0 0 441,631.7891 L441,620.2891 L431,610.2891 L173.5,610.2891 A3.5,3.5 0 0 0 170,613.7891 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M431,610.2891 L431,618.5391 A1.75,1.75 0 0 0 432.75,620.2891 L441,620.2891 L431,610.2891 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="176" y="627.356">Error Code: RECORD_ALREADY_EXISTS</text><polygon fill="#454645" points="1241.5,664.5547,1251.5,668.5547,1241.5,672.5547,1245.5,668.5547" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="1247.5" y1="668.5547" y2="668.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="767.5" y="663.4888">Check using clientReferenceId / serverGeneratedId</text><polygon fill="#454645" points="771.5,693.6875,761.5,697.6875,771.5,701.6875,767.5,697.6875" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="765.5" x2="1257.5" y1="697.6875" y2="697.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="777.5" y="692.6216">0 rows</text><polygon fill="#454645" points="2045.5,722.8203,2055.5,726.8203,2045.5,730.8203,2049.5,726.8203" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="2051.5" y1="726.8203" y2="726.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="767.5" y="721.7544">Check if record already exists</text><polygon fill="#454645" points="771.5,751.9531,761.5,755.9531,771.5,759.9531,767.5,755.9531" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="765.5" x2="2061.5" y1="755.9531" y2="755.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="777.5" y="750.8872">1 row</text><polygon fill="#454645" points="1241.5,781.0859,1251.5,785.0859,1241.5,789.0859,1245.5,785.0859" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="1247.5" y1="785.0859" y2="785.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396" x="767.5" y="780.02">Put data in cache using clientReferenceId / serverGeneratedId</text><polygon fill="#454645" points="457.5,843.2188,447.5,847.2188,457.5,851.2188,453.5,847.2188" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="451.5" x2="749.5" y1="847.2188" y2="847.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="463.5" y="842.1528">HttpStatus: 400 with appropriate error code</text><path d="M170,831.5859 L170,849.5859 A3.5,3.5 0 0 0 173.5,853.0859 L437.5,853.0859 A3.5,3.5 0 0 0 441,849.5859 L441,838.0859 L431,828.0859 L173.5,828.0859 A3.5,3.5 0 0 0 170,831.5859 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M431,828.0859 L431,836.3359 A1.75,1.75 0 0 0 432.75,838.0859 L441,838.0859 L431,828.0859 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="176" y="845.1528">Error Code: RECORD_ALREADY_EXISTS</text><path d="M197.5,872.2188 L260,872.2188 L260,879.3516 L250,889.3516 L194,889.3516 L194,875.7188 A3.5,3.5 0 0 1 197.5,872.2188 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="310.1953" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1925.5" x="194" y="872.2188"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="209" y="885.2856">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="419" x="275" y="884.4292">[individual(s) don't exist [loop on all individualId(s) in request]]</text><polygon fill="#454645" points="1016.5,906.4844,1026.5,910.4844,1016.5,914.4844,1020.5,910.4844" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="1022.5" y1="910.4844" y2="910.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="767.5" y="905.4185">/individual/v1/_search</text><polygon fill="#454645" points="771.5,935.6172,761.5,939.6172,771.5,943.6172,767.5,939.6172" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="765.5" x2="1032.5" y1="939.6172" y2="939.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="777.5" y="934.5513">0 rows</text><polygon fill="#454645" points="1330.5,975.3164,1340.5,979.3164,1330.5,983.3164,1334.5,979.3164" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="1336.5" y1="979.3164" y2="979.3164"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="767.5" y="974.2505">Household Data /error_topic</text><path d="M426,956.1172 L426,989.1172 A3.5,3.5 0 0 0 429.5,992.6172 L741.5,992.6172 A3.5,3.5 0 0 0 745,989.1172 L745,962.6172 L735,952.6172 L429.5,952.6172 A3.5,3.5 0 0 0 426,956.1172 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M735,952.6172 L735,960.8672 A1.75,1.75 0 0 0 736.75,962.6172 L745,962.6172 L735,952.6172 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="432" y="969.6841">This will be marked as recoverable and will be</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="432" y="984.8169">retried later</text><path d="M1310.5,1004.8828 L1394,1004.8828 L1394,1012.0156 L1384,1022.0156 L1307,1022.0156 L1307,1008.3828 A3.5,3.5 0 0 1 1310.5,1004.8828 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="135.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="802.5" x="1307" y="1004.8828"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1322" y="1017.9497">async</text><polygon fill="#454645" points="1363.5,1039.1484,1353.5,1043.1484,1363.5,1047.1484,1359.5,1043.1484" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1357.5" x2="1795.5" y1="1043.1484" y2="1043.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="1369.5" y="1038.0825">Consume Household Data</text><polygon fill="#454645" points="2045.5,1098.2813,2055.5,1102.2813,2045.5,1106.2813,2049.5,1102.2813" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1806.5" x2="2051.5" y1="1102.2813" y2="1102.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1813.5" y="1097.2153">Persist Household Data /error_table</text><polygon fill="#454645" points="457.5,1167.4141,447.5,1171.4141,457.5,1175.4141,453.5,1171.4141" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="451.5" x2="749.5" y1="1171.4141" y2="1171.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="463.5" y="1166.3481">HttpStatus: 400 with appropriate error code</text><path d="M204,1155.7813 L204,1173.7813 A3.5,3.5 0 0 0 207.5,1177.2813 L437.5,1177.2813 A3.5,3.5 0 0 0 441,1173.7813 L441,1162.2813 L431,1152.2813 L207.5,1152.2813 A3.5,3.5 0 0 0 204,1155.7813 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M431,1152.2813 L431,1160.5313 A1.75,1.75 0 0 0 432.75,1162.2813 L441,1162.2813 L431,1152.2813 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="210" y="1169.3481">Error Code: DEPENDENCY_ERROR</text><polygon fill="#454645" points="1016.5,1206.5469,1026.5,1210.5469,1016.5,1214.5469,1020.5,1210.5469" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="1022.5" y1="1210.5469" y2="1210.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="767.5" y="1205.481">/individual/v1/_search</text><polygon fill="#454645" points="771.5,1235.6797,761.5,1239.6797,771.5,1243.6797,767.5,1239.6797" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="765.5" x2="1032.5" y1="1239.6797" y2="1239.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="777.5" y="1234.6138">1 row</text><polygon fill="#454645" points="2045.5,1264.8125,2055.5,1268.8125,2045.5,1272.8125,2049.5,1268.8125" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="2051.5" y1="1268.8125" y2="1268.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="803" x="767.5" y="1263.7466">Get Individual/Household mapping using individual clientReferenceId/serverGeneratedId [loop on all individualId(s) in request]]</text><path d="M12.5,1283.8125 L75,1283.8125 L75,1290.9453 L65,1300.9453 L9,1300.9453 L9,1287.3125 A3.5,3.5 0 0 1 12.5,1283.8125 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="96.5313" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2100.5" x="9" y="1283.8125"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="24" y="1296.8794">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="158" x="90" y="1296.0229">[mapping record found]</text><polygon fill="#454645" points="771.5,1318.0781,761.5,1322.0781,771.5,1326.0781,767.5,1322.0781" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="765.5" x2="2056.5" y1="1322.0781" y2="1322.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="777.5" y="1317.0122">1 row</text><polygon fill="#454645" points="457.5,1357.7773,447.5,1361.7773,457.5,1365.7773,453.5,1361.7773" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="451.5" x2="749.5" y1="1361.7773" y2="1361.7773"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="463.5" y="1356.7114">HttpStatus: 400 with appropriate error code</text><path d="M19,1338.5781 L19,1371.5781 A3.5,3.5 0 0 0 22.5,1375.0781 L437.5,1375.0781 A3.5,3.5 0 0 0 441,1371.5781 L441,1345.0781 L431,1335.0781 L22.5,1335.0781 A3.5,3.5 0 0 0 19,1338.5781 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M431,1335.0781 L431,1343.3281 A1.75,1.75 0 0 0 432.75,1345.0781 L441,1345.0781 L431,1335.0781 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="25" y="1352.145">Error Code: BAD_REQUEST</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="401" x="25" y="1367.2778">Ensures that the individual is not already linked to a household</text><path d="M182.5,1394.3438 L245,1394.3438 L245,1401.4766 L235,1411.4766 L179,1411.4766 L179,1397.8438 A3.5,3.5 0 0 1 182.5,1394.3438 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="310.1953" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1994.5" x="179" y="1394.3438"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="194" y="1407.4106">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="134" x="260" y="1406.5542">[id generation fails]</text><polygon fill="#454645" points="2119.5,1428.6094,2129.5,1432.6094,2119.5,1436.6094,2123.5,1432.6094" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="2125.5" y1="1432.6094" y2="1432.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="767.5" y="1427.5435">/id/_generate</text><polygon fill="#454645" points="771.5,1457.7422,761.5,1461.7422,771.5,1465.7422,767.5,1461.7422" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="765.5" x2="2135.5" y1="1461.7422" y2="1461.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="777.5" y="1456.6763">HttpStatus: 400</text><polygon fill="#454645" points="1330.5,1497.4414,1340.5,1501.4414,1330.5,1505.4414,1334.5,1501.4414" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="1336.5" y1="1501.4414" y2="1501.4414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="767.5" y="1496.3755">Household Data /error_topic</text><path d="M470,1478.2422 L470,1511.2422 A3.5,3.5 0 0 0 473.5,1514.7422 L741.5,1514.7422 A3.5,3.5 0 0 0 745,1511.2422 L745,1484.7422 L735,1474.7422 L473.5,1474.7422 A3.5,3.5 0 0 0 470,1478.2422 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M735,1474.7422 L735,1482.9922 A1.75,1.75 0 0 0 736.75,1484.7422 L745,1484.7422 L735,1474.7422 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="476" y="1491.8091">This will be marked as recoverable and</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="476" y="1506.9419">will be retried later</text><path d="M1310.5,1527.0078 L1394,1527.0078 L1394,1534.1406 L1384,1544.1406 L1307,1544.1406 L1307,1530.5078 A3.5,3.5 0 0 1 1310.5,1527.0078 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="135.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="802.5" x="1307" y="1527.0078"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1322" y="1540.0747">async</text><polygon fill="#454645" points="1363.5,1561.2734,1353.5,1565.2734,1363.5,1569.2734,1359.5,1565.2734" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1357.5" x2="1795.5" y1="1565.2734" y2="1565.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="1369.5" y="1560.2075">Consume Household Data</text><polygon fill="#454645" points="2050.5,1620.4063,2060.5,1624.4063,2050.5,1628.4063,2054.5,1624.4063" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1806.5" x2="2056.5" y1="1624.4063" y2="1624.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1813.5" y="1619.3403">Persist Household Data /error_table</text><polygon fill="#454645" points="457.5,1689.5391,447.5,1693.5391,457.5,1697.5391,453.5,1693.5391" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="451.5" x2="749.5" y1="1693.5391" y2="1693.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="463.5" y="1688.4731">HttpStatus: 500 with appropriate error code</text><path d="M189,1677.9063 L189,1695.9063 A3.5,3.5 0 0 0 192.5,1699.4063 L437.5,1699.4063 A3.5,3.5 0 0 0 441,1695.9063 L441,1684.4063 L431,1674.4063 L192.5,1674.4063 A3.5,3.5 0 0 0 189,1677.9063 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M431,1674.4063 L431,1682.6563 A1.75,1.75 0 0 0 432.75,1684.4063 L441,1684.4063 L431,1674.4063 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="195" y="1691.4731">Error Code: ID_GENERATION_FAILED</text><polygon fill="#454645" points="2119.5,1728.6719,2129.5,1732.6719,2119.5,1736.6719,2123.5,1732.6719" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="2125.5" y1="1732.6719" y2="1732.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="767.5" y="1727.606">Generate ID</text><polygon fill="#454645" points="771.5,1757.8047,761.5,1761.8047,771.5,1765.8047,767.5,1761.8047" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="765.5" x2="2135.5" y1="1761.8047" y2="1761.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="777.5" y="1756.7388">Generated ID</text><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="802.5" y1="1790.9375" y2="1790.9375"/><line style="stroke:#454645;stroke-width:1.0;" x1="802.5" x2="802.5" y1="1790.9375" y2="1803.9375"/><line style="stroke:#454645;stroke-width:1.0;" x1="761.5" x2="802.5" y1="1803.9375" y2="1803.9375"/><polygon fill="#454645" points="771.5,1799.9375,761.5,1803.9375,771.5,1807.9375,767.5,1803.9375" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="767.5" y="1785.8716">Update generated ID in Household Data</text><polygon fill="#454645" points="1330.5,1829.0703,1340.5,1833.0703,1330.5,1837.0703,1334.5,1833.0703" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="1336.5" y1="1833.0703" y2="1833.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="767.5" y="1828.0044">Household Data /persist_topic</text><polygon fill="#454645" points="1241.5,1858.2031,1251.5,1862.2031,1241.5,1866.2031,1245.5,1862.2031" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="760.5" x2="1247.5" y1="1862.2031" y2="1862.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="474" x="767.5" y="1857.1372">Put Household Data against clientReferenceId/serverGeneratedId in cache</text><polygon fill="#454645" points="457.5,1917.3359,447.5,1921.3359,457.5,1925.3359,453.5,1921.3359" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="451.5" x2="754.5" y1="1921.3359" y2="1921.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="463.5" y="1916.27">HttpStatus: 202 ACCEPTED</text><path d="M1310.5,1936.3359 L1394,1936.3359 L1394,1943.4688 L1384,1953.4688 L1307,1953.4688 L1307,1939.8359 A3.5,3.5 0 0 1 1310.5,1936.3359 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="193.6641" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="802.5" x="1307" y="1936.3359"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1322" y="1949.4028">async</text><polygon fill="#454645" points="1363.5,1970.6016,1353.5,1974.6016,1363.5,1978.6016,1359.5,1974.6016" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1357.5" x2="1537.5" y1="1974.6016" y2="1974.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="1369.5" y="1969.5356">Consume Household Data</text><polygon fill="#454645" points="1363.5,1999.7344,1353.5,2003.7344,1363.5,2007.7344,1359.5,2003.7344" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1357.5" x2="1673.5" y1="2003.7344" y2="2003.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="1369.5" y="1998.6685">Consume Household Data</text><polygon fill="#454645" points="1901,2028.8672,1911,2032.8672,1901,2036.8672,1905,2032.8672" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1684.5" x2="1907" y1="2032.8672" y2="2032.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="1691.5" y="2027.8013">Store Household Data</text><polygon fill="#454645" points="2050.5,2088,2060.5,2092,2050.5,2096,2054.5,2092" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1548.5" x2="2056.5" y1="2092" y2="2092"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="1555.5" y="2086.9341">Persist Household Data</text><!--MD5=[d9d71ac4fd2dc2b2038b00c5e5c229a3]
@startuml
!theme vibrant
participant Client as c
participant HouseholdRegistry as s
participant IndividualRegistry as s2
participant RedisCache as rc
queue Kafka as k
participant PersisterService as prs
participant IndexerService as idx
participant ErrorService as es
participant ElasticSearch as el
database Database as db
c -> s : /household/v1/_create
activate s
s -> s: Validate request body
alt request validation fails
    s -> s: Request validation failed
    s -> k: Household Data /error_topic
    note left
        This will be marked as unrecoverable right away 
        and require manual intervention
    end note
    activate k
    group async
        es -> k: Consume Household Data
        activate es
        deactivate k
        es -> db: Persist Household Data /error_table
        activate db
        deactivate db
        deactivate es
    end
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: REQUEST_VALIDATION_FAILED
    end note
end
s -> s: Request validation successful
alt record already exists
    alt record found in cache
      s -> rc: Check using clientReferenceId / serverGeneratedId
      activate rc
      rc -> s: 1 row
      deactivate rc
      s -> c: HttpStatus: 400 with appropriate error code
      note left
          Error Code: RECORD_ALREADY_EXISTS
      end note
    end
    s -> rc: Check using clientReferenceId / serverGeneratedId
    activate rc
    rc -> s: 0 rows
    deactivate rc
    s -> db: Check if record already exists
    activate db
    db -> s: 1 row
    deactivate db
    s -> rc: Put data in cache using clientReferenceId / serverGeneratedId
    activate rc
    deactivate rc
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: RECORD_ALREADY_EXISTS
    end note
end
alt individual(s) don't exist [loop on all individualId(s) in request]
    s -> s2: /individual/v1/_search
    activate s2
    s2 -> s: 0 rows
    deactivate s2
    s -> k: Household Data /error_topic
    note left
        This will be marked as recoverable and will be 
        retried later
    end note
    activate k
    group async
        es -> k: Consume Household Data
        activate es
        deactivate k
        es -> db: Persist Household Data /error_table
        activate db
        deactivate db
        deactivate es
    end
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: DEPENDENCY_ERROR
    end note
end
s -> s2: /individual/v1/_search
activate s2
s2 -> s: 1 row
deactivate s2
s -> db: Get Individual/Household mapping using individual clientReferenceId/serverGeneratedId [loop on all individualId(s) in request]]
activate db
alt mapping record found
  db -> s: 1 row
  s -> c: HttpStatus: 400 with appropriate error code
  note left
      Error Code: BAD_REQUEST
      Ensures that the individual is not already linked to a household
  end note
end
alt id generation fails
    s -> idgen: /id/_generate
    activate idgen
    idgen -> s: HttpStatus: 400
    deactivate idgen
    s -> k: Household Data /error_topic
    note left
        This will be marked as recoverable and 
        will be retried later
    end note
    activate k
    group async
        es -> k: Consume Household Data
        activate es
        deactivate k
        es -> db: Persist Household Data /error_table
        activate db
        deactivate db
        deactivate es
    end
    s -> c: HttpStatus: 500 with appropriate error code
    note left
      Error Code: ID_GENERATION_FAILED
    end note
end
s -> idgen: Generate ID
activate idgen
idgen -> s: Generated ID
deactivate idgen
s -> s: Update generated ID in Household Data
s -> k: Household Data /persist_topic
activate k
s -> rc: Put Household Data against clientReferenceId/serverGeneratedId in cache
activate rc
deactivate rc
s -> c: HttpStatus: 202 ACCEPTED
deactivate s
group async
    prs -> k: Consume Household Data
    activate prs
    idx -> k: Consume Household Data
    activate idx
    idx -> el: Store Household Data
    activate el
    deactivate el
    deactivate idx
    prs -> db: Persist Household Data
    activate db
    deactivate db
    deactivate prs
end
deactivate k
@enduml

@startuml
skinparam BackgroundColor FFFFFF
skinparam shadowing false
skinparam RoundCorner 7
skinparam ArrowColor 454645
skinparam FontColor 454645
skinparam SequenceLifeLineBorderColor 696969
skinparam SequenceGroupHeaderFontColor 454645
skinparam SequenceGroupFontColor 696969
skinparam SequenceGroupBorderColor 696969
skinparam SequenceGroupBorderThickness 1

skinparam sequenceDivider {
    BorderColor 454645
    BorderThickness 1
    FontColor 454645
}

skinparam participant {
    BackgroundColor FF6347
    BorderColor 454645
    FontColor FFFFFF
    BorderThickness 1.5
}

skinparam database {
    BackgroundColor 00FFFF
    BorderColor 454645
    FontColor 454645
}

skinparam entity {
    BackgroundColor FFE552
    BorderColor 454645
    FontColor 454645
}

skinparam note {
    BackgroundColor 7FFFD4
    BorderColor 454645
    FontColor 454645
    BorderThickness 1.5
}

skinparam actor {
    BackgroundColor 454645
    BorderColor 454645
    FontColor 454645
}

skinparam boundary {
    BackgroundColor FFE552
    BorderColor 454645
    FontColor 454645
}

skinparam control {
    BackgroundColor FFE552
    BorderColor 454645
    FontColor 454645
}

skinparam collections {
    BackgroundColor FF5F42
    BorderColor 454645
    FontColor 454645
}

skinparam queue {
    BackgroundColor FF6347
    BorderColor 454645
    FontColor FFF
    BorderThickness 1.5
}
participant Client as c
participant HouseholdRegistry as s
participant IndividualRegistry as s2
participant RedisCache as rc
queue Kafka as k
participant PersisterService as prs
participant IndexerService as idx
participant ErrorService as es
participant ElasticSearch as el
database Database as db
c -> s : /household/v1/_create
activate s
s -> s: Validate request body
alt request validation fails
    s -> s: Request validation failed
    s -> k: Household Data /error_topic
    note left
        This will be marked as unrecoverable right away 
        and require manual intervention
    end note
    activate k
    group async
        es -> k: Consume Household Data
        activate es
        deactivate k
        es -> db: Persist Household Data /error_table
        activate db
        deactivate db
        deactivate es
    end
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: REQUEST_VALIDATION_FAILED
    end note
end
s -> s: Request validation successful
alt record already exists
    alt record found in cache
      s -> rc: Check using clientReferenceId / serverGeneratedId
      activate rc
      rc -> s: 1 row
      deactivate rc
      s -> c: HttpStatus: 400 with appropriate error code
      note left
          Error Code: RECORD_ALREADY_EXISTS
      end note
    end
    s -> rc: Check using clientReferenceId / serverGeneratedId
    activate rc
    rc -> s: 0 rows
    deactivate rc
    s -> db: Check if record already exists
    activate db
    db -> s: 1 row
    deactivate db
    s -> rc: Put data in cache using clientReferenceId / serverGeneratedId
    activate rc
    deactivate rc
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: RECORD_ALREADY_EXISTS
    end note
end
alt individual(s) don't exist [loop on all individualId(s) in request]
    s -> s2: /individual/v1/_search
    activate s2
    s2 -> s: 0 rows
    deactivate s2
    s -> k: Household Data /error_topic
    note left
        This will be marked as recoverable and will be 
        retried later
    end note
    activate k
    group async
        es -> k: Consume Household Data
        activate es
        deactivate k
        es -> db: Persist Household Data /error_table
        activate db
        deactivate db
        deactivate es
    end
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: DEPENDENCY_ERROR
    end note
end
s -> s2: /individual/v1/_search
activate s2
s2 -> s: 1 row
deactivate s2
s -> db: Get Individual/Household mapping using individual clientReferenceId/serverGeneratedId [loop on all individualId(s) in request]]
activate db
alt mapping record found
  db -> s: 1 row
  s -> c: HttpStatus: 400 with appropriate error code
  note left
      Error Code: BAD_REQUEST
      Ensures that the individual is not already linked to a household
  end note
end
alt id generation fails
    s -> idgen: /id/_generate
    activate idgen
    idgen -> s: HttpStatus: 400
    deactivate idgen
    s -> k: Household Data /error_topic
    note left
        This will be marked as recoverable and 
        will be retried later
    end note
    activate k
    group async
        es -> k: Consume Household Data
        activate es
        deactivate k
        es -> db: Persist Household Data /error_table
        activate db
        deactivate db
        deactivate es
    end
    s -> c: HttpStatus: 500 with appropriate error code
    note left
      Error Code: ID_GENERATION_FAILED
    end note
end
s -> idgen: Generate ID
activate idgen
idgen -> s: Generated ID
deactivate idgen
s -> s: Update generated ID in Household Data
s -> k: Household Data /persist_topic
activate k
s -> rc: Put Household Data against clientReferenceId/serverGeneratedId in cache
activate rc
deactivate rc
s -> c: HttpStatus: 202 ACCEPTED
deactivate s
group async
    prs -> k: Consume Household Data
    activate prs
    idx -> k: Consume Household Data
    activate idx
    idx -> el: Store Household Data
    activate el
    deactivate el
    deactivate idx
    prs -> db: Persist Household Data
    activate db
    deactivate db
    deactivate prs
end
deactivate k
@enduml

PlantUML version 1.2022.13beta8(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>