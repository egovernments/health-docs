<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2085px" preserveAspectRatio="none" style="width:2312px;height:2085px;background:#FFFFFF;" version="1.1" viewBox="0 0 2312 2085" width="2312px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="26.2969" id="_title" rx="3.5" ry="3.5" style="stroke:none;stroke-width:1.0;" width="235" x="1040.25" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="225" x="1045.25" y="27.9951">Household Member - Create</text><rect fill="#FFFFFF" height="1645.375" style="stroke:#696969;stroke-width:1.0;" width="10" x="762.5" y="135.7266"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1197.5" y="947.7813"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1327" y="605.4531"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1327" y="705.8516"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="1327" y="822.3828"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="1327" y="1703.8359"/><rect fill="#FFFFFF" height="93.832" style="stroke:#696969;stroke-width:1.0;" width="10" x="1416" y="283.8242"/><rect fill="#FFFFFF" height="93.832" style="stroke:#696969;stroke-width:1.0;" width="10" x="1416" y="1016.6133"/><rect fill="#FFFFFF" height="340.1953" style="stroke:#696969;stroke-width:1.0;" width="10" x="1416" y="1656.5703"/><rect fill="#FFFFFF" height="147.3984" style="stroke:#696969;stroke-width:1.0;" width="10" x="1671" y="1834.3672"/><rect fill="#FFFFFF" height="59.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1805.5" y="1863.5"/><rect fill="#FFFFFF" height="89.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1927.5" y="347.6563"/><rect fill="#FFFFFF" height="89.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1927.5" y="1080.4453"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2044" y="1892.6328"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="406.7891"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="764.1172"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="1139.5781"/><rect fill="#FFFFFF" height="139.6641" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="1247.8438"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="1482.9063"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="1951.7656"/><rect fill="none" height="294.0625" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2162.5" x="144" y="192.8594"/><rect fill="none" height="135.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="915.5" x="1381" y="309.3906"/><rect fill="none" height="352.4609" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2136.5" x="160" y="543.0547"/><rect fill="none" height="110.5313" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1221" x="170" y="567.1875"/><rect fill="none" height="310.1953" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2103.5" x="203" y="909.5156"/><rect fill="none" height="135.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="915.5" x="1381" y="1042.1797"/><rect fill="none" height="96.5313" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2287.5" x="9" y="1262.8438"/><rect fill="none" height="183.7969" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2058.5" x="238" y="1444.6406"/><rect fill="none" height="94.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="954.5" x="248" y="1527.0391"/><rect fill="none" height="193.6641" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="915.5" x="1381" y="1796.1016"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="456" x2="456" y1="104.5938" y2="2006.7656"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="767.5" x2="767.5" y1="104.5938" y2="2006.7656"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1202" x2="1202" y1="104.5938" y2="2006.7656"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1332" x2="1332" y1="104.5938" y2="2006.7656"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1421" x2="1421" y1="104.5938" y2="2006.7656"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1676" x2="1676" y1="104.5938" y2="2006.7656"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1810" x2="1810" y1="104.5938" y2="2006.7656"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1932" x2="1932" y1="104.5938" y2="2006.7656"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2049" x2="2049" y1="104.5938" y2="2006.7656"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2249.5" x2="2249.5" y1="104.5938" y2="2006.7656"/><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="55" x="429" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="436" y="93.292">Client</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="55" x="429" y="2005.7656"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="436" y="2025.7607">Client</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="148" x="693.5" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="700.5" y="93.292">HouseholdRegistry</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="148" x="693.5" y="2005.7656"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="700.5" y="2025.7607">HouseholdRegistry</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="141" x="1132" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="1139" y="93.292">IndividualRegistry</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="141" x="1132" y="2005.7656"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="1139" y="2025.7607">IndividualRegistry</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="98" x="1283" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1290" y="93.292">RedisCache</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="98" x="1283" y="2005.7656"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1290" y="2025.7607">RedisCache</text><path d="M1396,78.2969 L1446,78.2969 C1451,78.2969 1451,91.4453 1451,91.4453 C1451,91.4453 1451,104.5938 1446,104.5938 L1396,104.5938 C1391,104.5938 1391,91.4453 1391,91.4453 C1391,91.4453 1391,78.2969 1396,78.2969 " fill="#FF6347" style="stroke:#454645;stroke-width:1.5;"/><path d="M1446,78.2969 C1441,78.2969 1441,91.4453 1441,91.4453 C1441,104.5938 1446,104.5938 1446,104.5938 " fill="none" style="stroke:#454645;stroke-width:1.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1396" y="96.292">Kafka</text><path d="M1396,2005.7656 L1446,2005.7656 C1451,2005.7656 1451,2018.9141 1451,2018.9141 C1451,2018.9141 1451,2032.0625 1446,2032.0625 L1396,2032.0625 C1391,2032.0625 1391,2018.9141 1391,2018.9141 C1391,2018.9141 1391,2005.7656 1396,2005.7656 " fill="#FF6347" style="stroke:#454645;stroke-width:1.5;"/><path d="M1446,2005.7656 C1441,2005.7656 1441,2018.9141 1441,2018.9141 C1441,2032.0625 1446,2032.0625 1446,2032.0625 " fill="none" style="stroke:#454645;stroke-width:1.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1396" y="2023.7607">Kafka</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="128" x="1612" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114" x="1619" y="93.292">PersisterService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="128" x="1612" y="2005.7656"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114" x="1619" y="2025.7607">PersisterService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="121" x="1750" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="1757" y="93.292">IndexerService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="121" x="1750" y="2005.7656"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="1757" y="2025.7607">IndexerService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="103" x="1881" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1888" y="93.292">ErrorService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="103" x="1881" y="2005.7656"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1888" y="2025.7607">ErrorService</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="110" x="1994" y="73.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="2001" y="93.292">ElasticSearch</text><rect fill="#FF6347" height="30.2969" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="110" x="1994" y="2005.7656"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="2001" y="2025.7607">ElasticSearch</text><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="2212.5" y="101.292">Database</text><path d="M2231.5,52.2969 C2231.5,42.2969 2249.5,42.2969 2249.5,42.2969 C2249.5,42.2969 2267.5,42.2969 2267.5,52.2969 L2267.5,78.2969 C2267.5,88.2969 2249.5,88.2969 2249.5,88.2969 C2249.5,88.2969 2231.5,88.2969 2231.5,78.2969 L2231.5,52.2969 " fill="#00FFFF" style="stroke:#454645;stroke-width:1.5;"/><path d="M2231.5,52.2969 C2231.5,62.2969 2249.5,62.2969 2249.5,62.2969 C2249.5,62.2969 2267.5,62.2969 2267.5,52.2969 " fill="none" style="stroke:#454645;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="2212.5" y="2018.7607">Database</text><path d="M2231.5,2032.0625 C2231.5,2022.0625 2249.5,2022.0625 2249.5,2022.0625 C2249.5,2022.0625 2267.5,2022.0625 2267.5,2032.0625 L2267.5,2058.0625 C2267.5,2068.0625 2249.5,2068.0625 2249.5,2068.0625 C2249.5,2068.0625 2231.5,2068.0625 2231.5,2058.0625 L2231.5,2032.0625 " fill="#00FFFF" style="stroke:#454645;stroke-width:1.5;"/><path d="M2231.5,2032.0625 C2231.5,2042.0625 2249.5,2042.0625 2249.5,2042.0625 C2249.5,2042.0625 2267.5,2042.0625 2267.5,2032.0625 " fill="none" style="stroke:#454645;stroke-width:1.5;"/><rect fill="#FFFFFF" height="1645.375" style="stroke:#696969;stroke-width:1.0;" width="10" x="762.5" y="135.7266"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1197.5" y="947.7813"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1327" y="605.4531"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1327" y="705.8516"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="1327" y="822.3828"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="1327" y="1703.8359"/><rect fill="#FFFFFF" height="93.832" style="stroke:#696969;stroke-width:1.0;" width="10" x="1416" y="283.8242"/><rect fill="#FFFFFF" height="93.832" style="stroke:#696969;stroke-width:1.0;" width="10" x="1416" y="1016.6133"/><rect fill="#FFFFFF" height="340.1953" style="stroke:#696969;stroke-width:1.0;" width="10" x="1416" y="1656.5703"/><rect fill="#FFFFFF" height="147.3984" style="stroke:#696969;stroke-width:1.0;" width="10" x="1671" y="1834.3672"/><rect fill="#FFFFFF" height="59.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1805.5" y="1863.5"/><rect fill="#FFFFFF" height="89.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1927.5" y="347.6563"/><rect fill="#FFFFFF" height="89.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="1927.5" y="1080.4453"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2044" y="1892.6328"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="406.7891"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="764.1172"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="1139.5781"/><rect fill="#FFFFFF" height="139.6641" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="1247.8438"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="1482.9063"/><rect fill="#FFFFFF" height="30" style="stroke:#696969;stroke-width:1.0;" width="10" x="2244.5" y="1951.7656"/><polygon fill="#454645" points="750.5,131.7266,760.5,135.7266,750.5,139.7266,754.5,135.7266" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="456.5" x2="756.5" y1="135.7266" y2="135.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="463.5" y="130.6606">/household/member/v1/_create</text><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="814.5" y1="164.8594" y2="164.8594"/><line style="stroke:#454645;stroke-width:1.0;" x1="814.5" x2="814.5" y1="164.8594" y2="177.8594"/><line style="stroke:#454645;stroke-width:1.0;" x1="773.5" x2="814.5" y1="177.8594" y2="177.8594"/><polygon fill="#454645" points="783.5,173.8594,773.5,177.8594,783.5,181.8594,779.5,177.8594" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="779.5" y="159.7935">Validate request body</text><path d="M147.5,192.8594 L208,192.8594 L208,199.9922 L198,209.9922 L144,209.9922 L144,196.3594 A3.5,3.5 0 0 1 147.5,192.8594 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="294.0625" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2162.5" x="144" y="192.8594"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="159" y="205.9263">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="154" x="223" y="205.0698">[request validation fails]</text><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="814.5" y1="231.125" y2="231.125"/><line style="stroke:#454645;stroke-width:1.0;" x1="814.5" x2="814.5" y1="231.125" y2="244.125"/><line style="stroke:#454645;stroke-width:1.0;" x1="773.5" x2="814.5" y1="244.125" y2="244.125"/><polygon fill="#454645" points="783.5,240.125,773.5,244.125,783.5,248.125,779.5,244.125" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="779.5" y="226.0591">Request validation failed</text><polygon fill="#454645" points="1404,279.8242,1414,283.8242,1404,287.8242,1408,283.8242" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="1410" y1="283.8242" y2="283.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="779.5" y="278.7583">Household Member Data /error_topic</text><path d="M415,260.625 L415,293.625 A3.5,3.5 0 0 0 418.5,297.125 L753.5,297.125 A3.5,3.5 0 0 0 757,293.625 L757,267.125 L747,257.125 L418.5,257.125 A3.5,3.5 0 0 0 415,260.625 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M747,257.125 L747,265.375 A1.75,1.75 0 0 0 748.75,267.125 L757,267.125 L747,257.125 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="421" y="274.1919">This will be marked as unrecoverable right away</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="421" y="289.3247">and require manual intervention</text><path d="M1384.5,309.3906 L1468,309.3906 L1468,316.5234 L1458,326.5234 L1381,326.5234 L1381,312.8906 A3.5,3.5 0 0 1 1384.5,309.3906 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="135.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="915.5" x="1381" y="309.3906"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1396" y="322.4575">async</text><polygon fill="#454645" points="1437,343.6563,1427,347.6563,1437,351.6563,1433,347.6563" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1431" x2="1926.5" y1="347.6563" y2="347.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="1443" y="342.5903">Consume Household Member Data</text><polygon fill="#454645" points="2232.5,402.7891,2242.5,406.7891,2232.5,410.7891,2236.5,406.7891" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1937.5" x2="2238.5" y1="406.7891" y2="406.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288" x="1944.5" y="401.7231">Persist Household Member Data /error_table</text><polygon fill="#454645" points="467.5,471.9219,457.5,475.9219,467.5,479.9219,463.5,475.9219" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="461.5" x2="761.5" y1="475.9219" y2="475.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="473.5" y="470.856">HttpStatus: 400 with appropriate error code</text><path d="M154,460.2891 L154,478.2891 A3.5,3.5 0 0 0 157.5,481.7891 L447.5,481.7891 A3.5,3.5 0 0 0 451,478.2891 L451,466.7891 L441,456.7891 L157.5,456.7891 A3.5,3.5 0 0 0 154,460.2891 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M441,456.7891 L441,465.0391 A1.75,1.75 0 0 0 442.75,466.7891 L451,466.7891 L441,456.7891 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="160" y="473.856">Error Code: REQUEST_VALIDATION_FAILED</text><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="814.5" y1="515.0547" y2="515.0547"/><line style="stroke:#454645;stroke-width:1.0;" x1="814.5" x2="814.5" y1="515.0547" y2="528.0547"/><line style="stroke:#454645;stroke-width:1.0;" x1="773.5" x2="814.5" y1="528.0547" y2="528.0547"/><polygon fill="#454645" points="783.5,524.0547,773.5,528.0547,783.5,532.0547,779.5,528.0547" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="779.5" y="509.9888">Request validation successful</text><path d="M163.5,543.0547 L224,543.0547 L224,550.1875 L214,560.1875 L160,560.1875 L160,546.5547 A3.5,3.5 0 0 1 163.5,543.0547 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="352.4609" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2136.5" x="160" y="543.0547"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="175" y="556.1216">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="263" x="239" y="555.2651">[household member record already exists]</text><path d="M173.5,567.1875 L234,567.1875 L234,574.3203 L224,584.3203 L170,584.3203 L170,570.6875 A3.5,3.5 0 0 1 173.5,567.1875 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="110.5313" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="1221" x="170" y="567.1875"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="185" y="580.2544">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="147" x="249" y="579.3979">[record found in cache]</text><polygon fill="#454645" points="1315,601.4531,1325,605.4531,1315,609.4531,1319,605.4531" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="1321" y1="605.4531" y2="605.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="393" x="779.5" y="600.3872">Check using household clientReferenceId/serverGeneratedId</text><polygon fill="#454645" points="783.5,630.5859,773.5,634.5859,783.5,638.5859,779.5,634.5859" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="777.5" x2="1331" y1="634.5859" y2="634.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="789.5" y="629.52">1 row</text><polygon fill="#454645" points="467.5,662.7188,457.5,666.7188,467.5,670.7188,463.5,666.7188" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="461.5" x2="761.5" y1="666.7188" y2="666.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="473.5" y="661.6528">HttpStatus: 400 with appropriate error code</text><path d="M180,651.0859 L180,669.0859 A3.5,3.5 0 0 0 183.5,672.5859 L447.5,672.5859 A3.5,3.5 0 0 0 451,669.0859 L451,657.5859 L441,647.5859 L183.5,647.5859 A3.5,3.5 0 0 0 180,651.0859 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M441,647.5859 L441,655.8359 A1.75,1.75 0 0 0 442.75,657.5859 L451,657.5859 L441,647.5859 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="186" y="664.6528">Error Code: RECORD_ALREADY_EXISTS</text><polygon fill="#454645" points="1315,701.8516,1325,705.8516,1315,709.8516,1319,705.8516" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="1321" y1="705.8516" y2="705.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="393" x="779.5" y="700.7856">Check using household clientReferenceId/serverGeneratedId</text><polygon fill="#454645" points="783.5,730.9844,773.5,734.9844,783.5,738.9844,779.5,734.9844" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="777.5" x2="1331" y1="734.9844" y2="734.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="789.5" y="729.9185">0 rows</text><polygon fill="#454645" points="2232.5,760.1172,2242.5,764.1172,2232.5,768.1172,2236.5,764.1172" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="2238.5" y1="764.1172" y2="764.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="779.5" y="759.0513">Check if record already exists</text><polygon fill="#454645" points="783.5,789.25,773.5,793.25,783.5,797.25,779.5,793.25" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="777.5" x2="2248.5" y1="793.25" y2="793.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="789.5" y="788.1841">1 row</text><polygon fill="#454645" points="1315,818.3828,1325,822.3828,1315,826.3828,1319,822.3828" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="1321" y1="822.3828" y2="822.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="465" x="779.5" y="817.3169">Put data in cache using household clientReferenceId/serverGeneratedId</text><polygon fill="#454645" points="467.5,880.5156,457.5,884.5156,467.5,888.5156,463.5,884.5156" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="461.5" x2="761.5" y1="884.5156" y2="884.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="473.5" y="879.4497">HttpStatus: 400 with appropriate error code</text><path d="M180,868.8828 L180,886.8828 A3.5,3.5 0 0 0 183.5,890.3828 L447.5,890.3828 A3.5,3.5 0 0 0 451,886.8828 L451,875.3828 L441,865.3828 L183.5,865.3828 A3.5,3.5 0 0 0 180,868.8828 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M441,865.3828 L441,873.6328 A1.75,1.75 0 0 0 442.75,875.3828 L451,875.3828 L441,865.3828 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="186" y="882.4497">Error Code: RECORD_ALREADY_EXISTS</text><path d="M206.5,909.5156 L267,909.5156 L267,916.6484 L257,926.6484 L203,926.6484 L203,913.0156 A3.5,3.5 0 0 1 206.5,909.5156 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="310.1953" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2103.5" x="203" y="909.5156"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="218" y="922.5825">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="156" x="282" y="921.7261">[individual doesn't exist]</text><polygon fill="#454645" points="1185.5,943.7813,1195.5,947.7813,1185.5,951.7813,1189.5,947.7813" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="1191.5" y1="947.7813" y2="947.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="779.5" y="942.7153">/individual/v1/_search</text><polygon fill="#454645" points="783.5,972.9141,773.5,976.9141,783.5,980.9141,779.5,976.9141" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="777.5" x2="1201.5" y1="976.9141" y2="976.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="789.5" y="971.8481">0 rows</text><polygon fill="#454645" points="1404,1012.6133,1414,1016.6133,1404,1020.6133,1408,1016.6133" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="1410" y1="1016.6133" y2="1016.6133"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="779.5" y="1011.5474">Household Member Data /error_topic</text><path d="M429,993.4141 L429,1026.4141 A3.5,3.5 0 0 0 432.5,1029.9141 L753.5,1029.9141 A3.5,3.5 0 0 0 757,1026.4141 L757,999.9141 L747,989.9141 L432.5,989.9141 A3.5,3.5 0 0 0 429,993.4141 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M747,989.9141 L747,998.1641 A1.75,1.75 0 0 0 748.75,999.9141 L757,999.9141 L747,989.9141 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="435" y="1006.981">This will be marked as recoverable and will be</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="435" y="1022.1138">retried later</text><path d="M1384.5,1042.1797 L1468,1042.1797 L1468,1049.3125 L1458,1059.3125 L1381,1059.3125 L1381,1045.6797 A3.5,3.5 0 0 1 1384.5,1042.1797 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="135.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="915.5" x="1381" y="1042.1797"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1396" y="1055.2466">async</text><polygon fill="#454645" points="1437,1076.4453,1427,1080.4453,1437,1084.4453,1433,1080.4453" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1431" x2="1926.5" y1="1080.4453" y2="1080.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="1443" y="1075.3794">Consume Household Member Data</text><polygon fill="#454645" points="2232.5,1135.5781,2242.5,1139.5781,2232.5,1143.5781,2236.5,1139.5781" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1937.5" x2="2238.5" y1="1139.5781" y2="1139.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288" x="1944.5" y="1134.5122">Persist Household Member Data /error_table</text><polygon fill="#454645" points="467.5,1204.7109,457.5,1208.7109,467.5,1212.7109,463.5,1208.7109" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="461.5" x2="761.5" y1="1208.7109" y2="1208.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="473.5" y="1203.645">HttpStatus: 400 with appropriate error code</text><path d="M213,1193.0781 L213,1211.0781 A3.5,3.5 0 0 0 216.5,1214.5781 L447.5,1214.5781 A3.5,3.5 0 0 0 451,1211.0781 L451,1199.5781 L441,1189.5781 L216.5,1189.5781 A3.5,3.5 0 0 0 213,1193.0781 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M441,1189.5781 L441,1197.8281 A1.75,1.75 0 0 0 442.75,1199.5781 L451,1199.5781 L441,1189.5781 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="219" y="1206.645">Error Code: DEPENDENCY_ERROR</text><polygon fill="#454645" points="2232.5,1243.8438,2242.5,1247.8438,2232.5,1251.8438,2236.5,1247.8438" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="2238.5" y1="1247.8438" y2="1247.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="575" x="779.5" y="1242.7778">Get Individual/Household mapping using individual clientReferenceId/serverGeneratedId</text><path d="M12.5,1262.8438 L73,1262.8438 L73,1269.9766 L63,1279.9766 L9,1279.9766 L9,1266.3438 A3.5,3.5 0 0 1 12.5,1262.8438 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="96.5313" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2287.5" x="9" y="1262.8438"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="24" y="1275.9106">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="91" x="88" y="1275.0542">[record found]</text><polygon fill="#454645" points="783.5,1297.1094,773.5,1301.1094,783.5,1305.1094,779.5,1301.1094" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="777.5" x2="2243.5" y1="1301.1094" y2="1301.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="789.5" y="1296.0435">1 row</text><polygon fill="#454645" points="467.5,1336.8086,457.5,1340.8086,467.5,1344.8086,463.5,1340.8086" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="461.5" x2="761.5" y1="1340.8086" y2="1340.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="473.5" y="1335.7427">HttpStatus: 400 with appropriate error code</text><path d="M19,1317.6094 L19,1350.6094 A3.5,3.5 0 0 0 22.5,1354.1094 L447.5,1354.1094 A3.5,3.5 0 0 0 451,1350.6094 L451,1324.1094 L441,1314.1094 L22.5,1314.1094 A3.5,3.5 0 0 0 19,1317.6094 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M441,1314.1094 L441,1322.3594 A1.75,1.75 0 0 0 442.75,1324.1094 L451,1324.1094 L441,1314.1094 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="25" y="1331.1763">Error Code: BAD_REQUEST</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="411" x="25" y="1346.3091">Ensures that the individual is not already linked to a household</text><polygon fill="#454645" points="783.5,1383.5078,773.5,1387.5078,783.5,1391.5078,779.5,1387.5078" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="777.5" x2="2248.5" y1="1387.5078" y2="1387.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="789.5" y="1382.4419">0 rows</text><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="814.5" y1="1416.6406" y2="1416.6406"/><line style="stroke:#454645;stroke-width:1.0;" x1="814.5" x2="814.5" y1="1416.6406" y2="1429.6406"/><line style="stroke:#454645;stroke-width:1.0;" x1="773.5" x2="814.5" y1="1429.6406" y2="1429.6406"/><polygon fill="#454645" points="783.5,1425.6406,773.5,1429.6406,783.5,1433.6406,779.5,1429.6406" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300" x="779.5" y="1411.5747">Check if isHeadOfHousehold is true in request</text><path d="M241.5,1444.6406 L302,1444.6406 L302,1451.7734 L292,1461.7734 L238,1461.7734 L238,1448.1406 A3.5,3.5 0 0 1 241.5,1444.6406 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="183.7969" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="2058.5" x="238" y="1444.6406"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="253" y="1457.7075">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="213" x="317" y="1456.8511">[request isHeadOfHousehold true]</text><polygon fill="#454645" points="2232.5,1478.9063,2242.5,1482.9063,2232.5,1486.9063,2236.5,1482.9063" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="2238.5" y1="1482.9063" y2="1482.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="578" x="779.5" y="1477.8403">Get Individual/Household mapping using household clientReferenceId/serverGeneratedId</text><polygon fill="#454645" points="783.5,1508.0391,773.5,1512.0391,783.5,1516.0391,779.5,1512.0391" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="777.5" x2="2248.5" y1="1512.0391" y2="1512.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="789.5" y="1506.9731">1-n row(s)</text><path d="M251.5,1527.0391 L312,1527.0391 L312,1534.1719 L302,1544.1719 L248,1544.1719 L248,1530.5391 A3.5,3.5 0 0 1 251.5,1527.0391 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="94.3984" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="954.5" x="248" y="1527.0391"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="263" y="1540.106">alt</text><text fill="#696969" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="278" x="327" y="1539.2495">[record with isHeadOfHousehold true found]</text><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="814.5" y1="1565.3047" y2="1565.3047"/><line style="stroke:#454645;stroke-width:1.0;" x1="814.5" x2="814.5" y1="1565.3047" y2="1578.3047"/><line style="stroke:#454645;stroke-width:1.0;" x1="773.5" x2="814.5" y1="1578.3047" y2="1578.3047"/><polygon fill="#454645" points="783.5,1574.3047,773.5,1578.3047,783.5,1582.3047,779.5,1578.3047" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="411" x="779.5" y="1560.2388">Check if there is already a record with isHeadOfHousehold true</text><polygon fill="#454645" points="467.5,1606.4375,457.5,1610.4375,467.5,1614.4375,463.5,1610.4375" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="461.5" x2="761.5" y1="1610.4375" y2="1610.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="473.5" y="1605.3716">HttpStatus: 400 with appropriate error code</text><path d="M258,1594.8047 L258,1612.8047 A3.5,3.5 0 0 0 261.5,1616.3047 L447.5,1616.3047 A3.5,3.5 0 0 0 451,1612.8047 L451,1601.3047 L441,1591.3047 L261.5,1591.3047 A3.5,3.5 0 0 0 258,1594.8047 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M441,1591.3047 L441,1599.5547 A1.75,1.75 0 0 0 442.75,1601.3047 L451,1601.3047 L441,1591.3047 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="264" y="1608.3716">Error Code: BAD_REQUEST</text><polygon fill="#454645" points="1404,1652.5703,1414,1656.5703,1404,1660.5703,1408,1656.5703" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="1410" y1="1656.5703" y2="1656.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="779.5" y="1651.5044">Household Member Data /persist_topic</text><polygon fill="#454645" points="1315,1699.8359,1325,1703.8359,1315,1707.8359,1319,1703.8359" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="772.5" x2="1321" y1="1703.8359" y2="1703.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="460" x="779.5" y="1698.77">Invalidate household cache using clientReferenceId/serverGeneratedId</text><path d="M352,1673.0703 L352,1721.0703 A3.5,3.5 0 0 0 355.5,1724.5703 L753.5,1724.5703 A3.5,3.5 0 0 0 757,1721.0703 L757,1679.5703 L747,1669.5703 L355.5,1669.5703 A3.5,3.5 0 0 0 352,1673.0703 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><path d="M747,1669.5703 L747,1677.8203 A1.75,1.75 0 0 0 748.75,1679.5703 L757,1679.5703 L747,1669.5703 " fill="#7FFFD4" style="stroke:#181818;stroke-width:1.5;"/><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="358" y="1686.6372">The request does not have all the data required to update</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="384" x="358" y="1701.77">the household cache for which this member is being added</text><text fill="#454645" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="358" y="1716.9028">and hence is being invalidated.</text><polygon fill="#454645" points="467.5,1777.1016,457.5,1781.1016,467.5,1785.1016,463.5,1781.1016" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="461.5" x2="766.5" y1="1781.1016" y2="1781.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="473.5" y="1776.0356">HttpStatus: 202 ACCEPTED</text><path d="M1384.5,1796.1016 L1468,1796.1016 L1468,1803.2344 L1458,1813.2344 L1381,1813.2344 L1381,1799.6016 A3.5,3.5 0 0 1 1384.5,1796.1016 " fill="#EEEEEE" style="stroke:#696969;stroke-width:1.5;"/><rect fill="none" height="193.6641" rx="3.5" ry="3.5" style="stroke:#696969;stroke-width:1.0;" width="915.5" x="1381" y="1796.1016"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1396" y="1809.1685">async</text><polygon fill="#454645" points="1437,1830.3672,1427,1834.3672,1437,1838.3672,1433,1834.3672" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1431" x2="1670" y1="1834.3672" y2="1834.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="1443" y="1829.3013">Consume Household Member Data</text><polygon fill="#454645" points="1437,1859.5,1427,1863.5,1437,1867.5,1433,1863.5" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1431" x2="1804.5" y1="1863.5" y2="1863.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="1443" y="1858.4341">Consume Household Member Data</text><polygon fill="#454645" points="2032,1888.6328,2042,1892.6328,2032,1896.6328,2036,1892.6328" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1815.5" x2="2038" y1="1892.6328" y2="1892.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="1822.5" y="1887.5669">Store Household Member Data</text><polygon fill="#454645" points="2232.5,1947.7656,2242.5,1951.7656,2232.5,1955.7656,2236.5,1951.7656" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="1681" x2="2238.5" y1="1951.7656" y2="1951.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="1688" y="1946.6997">Persist Household Member Data</text><!--MD5=[9a4c97c4838870a1f26ec7f7cf7cf91b]
@startuml
title Household Member - Create
!theme vibrant
participant Client as c
participant HouseholdRegistry as s
participant IndividualRegistry as s2
participant RedisCache as rc
queue Kafka as k
participant PersisterService as prs
participant IndexerService as idx
participant ErrorService as es
participant ElasticSearch as el
database Database as db
c -> s : /household/member/v1/_create
activate s
s -> s: Validate request body
alt request validation fails
    s -> s: Request validation failed
    s -> k: Household Member Data /error_topic
    note left
        This will be marked as unrecoverable right away 
        and require manual intervention
    end note
    activate k
    group async
        es -> k: Consume Household Member Data
        activate es
        deactivate k
        es -> db: Persist Household Member Data /error_table
        activate db
        deactivate db
        deactivate es
    end
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: REQUEST_VALIDATION_FAILED
    end note
end
s -> s: Request validation successful
alt household member record already exists
    alt record found in cache
      s -> rc: Check using household clientReferenceId/serverGeneratedId
      activate rc
      rc -> s: 1 row
      deactivate rc
      s -> c: HttpStatus: 400 with appropriate error code
      note left
          Error Code: RECORD_ALREADY_EXISTS
      end note
    end
    s -> rc: Check using household clientReferenceId/serverGeneratedId
    activate rc
    rc -> s: 0 rows
    deactivate rc
    s -> db: Check if record already exists
    activate db
    db -> s: 1 row
    deactivate db
    s -> rc: Put data in cache using household clientReferenceId/serverGeneratedId
    activate rc
    deactivate rc
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: RECORD_ALREADY_EXISTS
    end note
end
'alt household doesn't exist
'    s -> db: Check if household exists
'    activate db
'    db -> s: 0 rows
'    deactivate db
'    s -> k: Household Member Data /error_topic
'    note left
'        This will be marked as recoverable and will be
'        retried later
'    end note
'    activate k
'    group async
'        es -> k: Consume Household Member Data
'        activate es
'        deactivate k
'        es -> db: Persist Household Member Data /error_table
'        activate db
'        deactivate db
'        deactivate es
'    end
'    s -> c: HttpStatus: 400 with appropriate error code
'    note left
'        Error Code: DEPENDENCY_ERROR
'    end note
'end
alt individual doesn't exist
    s -> s2: /individual/v1/_search
    activate s2
    s2 -> s: 0 rows
    deactivate s2
    s -> k: Household Member Data /error_topic
    note left
        This will be marked as recoverable and will be 
        retried later
    end note
    activate k
    group async
        es -> k: Consume Household Member Data
        activate es
        deactivate k
        es -> db: Persist Household Member Data /error_table
        activate db
        deactivate db
        deactivate es
    end
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: DEPENDENCY_ERROR
    end note
end
s -> db: Get Individual/Household mapping using individual clientReferenceId/serverGeneratedId
activate db
alt record found
  db -> s: 1 row
  s -> c: HttpStatus: 400 with appropriate error code
  note left
      Error Code: BAD_REQUEST
      Ensures that the individual is not already linked to a household
  end note
end
db -> s: 0 rows
deactivate db
s -> s: Check if isHeadOfHousehold is true in request
alt request isHeadOfHousehold true
  s -> db: Get Individual/Household mapping using household clientReferenceId/serverGeneratedId
  activate db
  db -> s: 1-n row(s)
  deactivate db
  alt record with isHeadOfHousehold true found
    s -> s: Check if there is already a record with isHeadOfHousehold true
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: BAD_REQUEST
    end note
  end
end

s -> k: Household Member Data /persist_topic
activate k
s -> rc: Invalidate household cache using clientReferenceId/serverGeneratedId
note left
  The request does not have all the data required to update
  the household cache for which this member is being added
  and hence is being invalidated.
end note
activate rc
deactivate rc
s -> c: HttpStatus: 202 ACCEPTED
deactivate s
group async
    prs -> k: Consume Household Member Data
    activate prs
    idx -> k: Consume Household Member Data
    activate idx
    idx -> el: Store Household Member Data
    activate el
    deactivate el
    deactivate idx
    prs -> db: Persist Household Member Data
    activate db
    deactivate db
    deactivate prs
end
deactivate k
@enduml

@startuml
title Household Member - Create
skinparam BackgroundColor FFFFFF
skinparam shadowing false
skinparam RoundCorner 7
skinparam ArrowColor 454645
skinparam FontColor 454645
skinparam SequenceLifeLineBorderColor 696969
skinparam SequenceGroupHeaderFontColor 454645
skinparam SequenceGroupFontColor 696969
skinparam SequenceGroupBorderColor 696969
skinparam SequenceGroupBorderThickness 1

skinparam sequenceDivider {
    BorderColor 454645
    BorderThickness 1
    FontColor 454645
}

skinparam participant {
    BackgroundColor FF6347
    BorderColor 454645
    FontColor FFFFFF
    BorderThickness 1.5
}

skinparam database {
    BackgroundColor 00FFFF
    BorderColor 454645
    FontColor 454645
}

skinparam entity {
    BackgroundColor FFE552
    BorderColor 454645
    FontColor 454645
}

skinparam note {
    BackgroundColor 7FFFD4
    BorderColor 454645
    FontColor 454645
    BorderThickness 1.5
}

skinparam actor {
    BackgroundColor 454645
    BorderColor 454645
    FontColor 454645
}

skinparam boundary {
    BackgroundColor FFE552
    BorderColor 454645
    FontColor 454645
}

skinparam control {
    BackgroundColor FFE552
    BorderColor 454645
    FontColor 454645
}

skinparam collections {
    BackgroundColor FF5F42
    BorderColor 454645
    FontColor 454645
}

skinparam queue {
    BackgroundColor FF6347
    BorderColor 454645
    FontColor FFF
    BorderThickness 1.5
}
participant Client as c
participant HouseholdRegistry as s
participant IndividualRegistry as s2
participant RedisCache as rc
queue Kafka as k
participant PersisterService as prs
participant IndexerService as idx
participant ErrorService as es
participant ElasticSearch as el
database Database as db
c -> s : /household/member/v1/_create
activate s
s -> s: Validate request body
alt request validation fails
    s -> s: Request validation failed
    s -> k: Household Member Data /error_topic
    note left
        This will be marked as unrecoverable right away 
        and require manual intervention
    end note
    activate k
    group async
        es -> k: Consume Household Member Data
        activate es
        deactivate k
        es -> db: Persist Household Member Data /error_table
        activate db
        deactivate db
        deactivate es
    end
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: REQUEST_VALIDATION_FAILED
    end note
end
s -> s: Request validation successful
alt household member record already exists
    alt record found in cache
      s -> rc: Check using household clientReferenceId/serverGeneratedId
      activate rc
      rc -> s: 1 row
      deactivate rc
      s -> c: HttpStatus: 400 with appropriate error code
      note left
          Error Code: RECORD_ALREADY_EXISTS
      end note
    end
    s -> rc: Check using household clientReferenceId/serverGeneratedId
    activate rc
    rc -> s: 0 rows
    deactivate rc
    s -> db: Check if record already exists
    activate db
    db -> s: 1 row
    deactivate db
    s -> rc: Put data in cache using household clientReferenceId/serverGeneratedId
    activate rc
    deactivate rc
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: RECORD_ALREADY_EXISTS
    end note
end
alt individual doesn't exist
    s -> s2: /individual/v1/_search
    activate s2
    s2 -> s: 0 rows
    deactivate s2
    s -> k: Household Member Data /error_topic
    note left
        This will be marked as recoverable and will be 
        retried later
    end note
    activate k
    group async
        es -> k: Consume Household Member Data
        activate es
        deactivate k
        es -> db: Persist Household Member Data /error_table
        activate db
        deactivate db
        deactivate es
    end
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: DEPENDENCY_ERROR
    end note
end
s -> db: Get Individual/Household mapping using individual clientReferenceId/serverGeneratedId
activate db
alt record found
  db -> s: 1 row
  s -> c: HttpStatus: 400 with appropriate error code
  note left
      Error Code: BAD_REQUEST
      Ensures that the individual is not already linked to a household
  end note
end
db -> s: 0 rows
deactivate db
s -> s: Check if isHeadOfHousehold is true in request
alt request isHeadOfHousehold true
  s -> db: Get Individual/Household mapping using household clientReferenceId/serverGeneratedId
  activate db
  db -> s: 1-n row(s)
  deactivate db
  alt record with isHeadOfHousehold true found
    s -> s: Check if there is already a record with isHeadOfHousehold true
    s -> c: HttpStatus: 400 with appropriate error code
    note left
        Error Code: BAD_REQUEST
    end note
  end
end

s -> k: Household Member Data /persist_topic
activate k
s -> rc: Invalidate household cache using clientReferenceId/serverGeneratedId
note left
  The request does not have all the data required to update
  the household cache for which this member is being added
  and hence is being invalidated.
end note
activate rc
deactivate rc
s -> c: HttpStatus: 202 ACCEPTED
deactivate s
group async
    prs -> k: Consume Household Member Data
    activate prs
    idx -> k: Consume Household Member Data
    activate idx
    idx -> el: Store Household Member Data
    activate el
    deactivate el
    deactivate idx
    prs -> db: Persist Household Member Data
    activate db
    deactivate db
    deactivate prs
end
deactivate k
@enduml

PlantUML version 1.2022.12(Sun Oct 23 23:42:26 IST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>